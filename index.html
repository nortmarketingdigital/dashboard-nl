<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard CS - NL Tecnologia</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f7fa;
            color: #0A1628;
        }

        /* Loading */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
            z-index: 9999;
        }

        .loading.hidden {
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f0f0f0;
            border-top-color: #FF6600;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Config Panel */
        .config-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .config-panel.hidden {
            display: none;
        }

        .config-box {
            background: #fff;
            padding: 40px;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .config-box h2 {
            color: #0A1628;
            margin-bottom: 10px;
        }

        .config-box p {
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
            line-height: 1.6;
        }

        .config-box input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
            transition: border-color 0.2s;
        }

        .config-box input:focus {
            outline: none;
            border-color: #FF6600;
        }

        .config-box button {
            width: 100%;
            padding: 14px;
            background: #FF6600;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .config-box button:hover {
            background: #e55a00;
        }

        .config-box .help {
            margin-top: 20px;
            padding: 16px;
            background: #f5f7fa;
            border-radius: 8px;
            font-size: 12px;
            color: #666;
        }

        .config-box .help code {
            background: #e0e0e0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 220px;
            height: 100vh;
            background: linear-gradient(180deg, #0A1628 0%, #1a2942 100%);
            padding: 20px 0;
            z-index: 100;
        }

        .logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .logo h1 {
            color: #FF6600;
            font-size: 28px;
            font-weight: 700;
        }

        .logo span {
            color: #fff;
            font-size: 12px;
            opacity: 0.7;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 14px 25px;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover {
            background: rgba(255,102,0,0.1);
            color: #fff;
        }

        .nav-item.active {
            background: rgba(255,102,0,0.15);
            color: #FF6600;
            border-left-color: #FF6600;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            opacity: 0.8;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            padding: 0 20px;
        }

        .refresh-btn {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .last-update {
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-size: 10px;
            margin-top: 10px;
        }

        /* Main Content */
        .main-content {
            margin-left: 220px;
            padding: 25px 30px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .page-title {
            font-size: 26px;
            font-weight: 700;
            color: #0A1628;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .filter-btn {
            padding: 10px 18px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: #FF6600;
            color: #FF6600;
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 18px;
            margin-bottom: 25px;
        }

        .kpi-card {
            background: #fff;
            border-radius: 12px;
            padding: 22px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            border-left: 4px solid #FF6600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .kpi-card.success { border-left-color: #00C853; }
        .kpi-card.warning { border-left-color: #FFB300; }
        .kpi-card.danger { border-left-color: #E53935; }

        .kpi-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            color: #0A1628;
            margin-bottom: 6px;
        }

        .kpi-trend {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .kpi-trend.up { color: #00C853; }
        .kpi-trend.down { color: #E53935; }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .chart-card {
            background: #fff;
            border-radius: 12px;
            padding: 22px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: #0A1628;
        }

        /* Bar Chart */
        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 250px;
            padding: 20px 0;
            border-bottom: 2px solid #f0f0f0;
        }

        .bar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .bar {
            width: 45px;
            background: linear-gradient(180deg, #FF6600 0%, #ff8533 100%);
            border-radius: 6px 6px 0 0;
            transition: all 0.3s;
            position: relative;
            min-height: 20px;
        }

        .bar:hover {
            background: linear-gradient(180deg, #e55a00 0%, #FF6600 100%);
            transform: scaleY(1.02);
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: 600;
            color: #0A1628;
        }

        .bar-label {
            font-size: 11px;
            color: #666;
            text-align: center;
        }

        /* Progress Bar */
        .progress-row {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .progress-label {
            width: 120px;
            font-size: 13px;
            color: #333;
        }

        .progress-bar {
            flex: 1;
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6600, #ff8533);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .progress-fill.success { background: linear-gradient(90deg, #00C853, #4caf50); }
        .progress-fill.warning { background: linear-gradient(90deg, #FFB300, #ffc107); }
        .progress-fill.danger { background: linear-gradient(90deg, #E53935, #f44336); }

        .progress-value {
            width: 50px;
            font-weight: 600;
            text-align: right;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 14px 16px;
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #f0f0f0;
            font-weight: 600;
        }

        .data-table td {
            padding: 14px 16px;
            font-size: 13px;
            border-bottom: 1px solid #f5f5f5;
        }

        .data-table tr:hover {
            background: #fafafa;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-badge.success { background: #e8f5e9; color: #00C853; }
        .status-badge.warning { background: #fff8e1; color: #FFB300; }
        .status-badge.danger { background: #ffebee; color: #E53935; }

        /* Donut Chart */
        .donut-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .donut {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            position: relative;
        }

        .donut-hole {
            width: 100px;
            height: 100px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 30px;
            left: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .donut-value {
            font-size: 28px;
            font-weight: 700;
        }

        .donut-label {
            font-size: 11px;
            color: #666;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Checklist */
        .checklist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .checklist-item.success { background: #e8f5e9; }
        .checklist-item.warning { background: #fff8e1; }
        .checklist-item.danger { background: #ffebee; }

        .checklist-item span:last-child {
            font-weight: 600;
        }

        .checklist-item.success span:last-child { color: #00C853; }
        .checklist-item.warning span:last-child { color: #FFB300; }
        .checklist-item.danger span:last-child { color: #E53935; }

        /* Responsive */
        @media (max-width: 1400px) {
            .kpi-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 1100px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .kpi-card, .chart-card {
            animation: fadeIn 0.4s ease-out forwards;
        }
    </style>
</head>
<body>
    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <span>Carregando dados...</span>
    </div>

    <!-- Config Panel -->
    <div class="config-panel" id="configPanel">
        <div class="config-box">
            <h2>üîó Conectar ao Google Sheets</h2>
            <p>Para conectar o dashboard aos seus dados, cole o <strong>ID da planilha</strong> do Google Sheets abaixo.</p>
            
            <input type="text" id="sheetId" placeholder="Cole o ID da planilha aqui...">
            <button onclick="connectSheet()">Conectar</button>
            
            <div class="help">
                <strong>Como encontrar o ID:</strong><br><br>
                O ID est√° na URL da planilha:<br>
                <code>https://docs.google.com/spreadsheets/d/<strong>ID_AQUI</strong>/edit</code><br><br>
                <strong>Importante:</strong> A planilha precisa estar com compartilhamento p√∫blico ("Qualquer pessoa com o link pode ver")
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="logo">
            <h1>NL</h1>
            <span>Tecnologia</span>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active" onclick="showPage('executivo', this)">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                Vis√£o Executiva
            </li>
            <li class="nav-item" onclick="showPage('gestao', this)">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                Gest√£o
            </li>
            <li class="nav-item" onclick="showPage('operacional', this)">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65z"/></svg>
                Operacional
            </li>
            <li class="nav-item" onclick="showPage('governanca', this)">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
                Governan√ßa
            </li>
            <li class="nav-item" onclick="showPage('clientes', this)">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93z"/></svg>
                Clientes
            </li>
        </ul>
        <div class="sidebar-footer">
            <button class="refresh-btn" onclick="loadData()">
                üîÑ Atualizar Dados
            </button>
            <div class="last-update" id="lastUpdate">√öltima atualiza√ß√£o: --</div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- P√ÅGINA 1: VIS√ÉO EXECUTIVA -->
        <div id="page-executivo" class="page-content active">
            <header class="header">
                <h1 class="page-title">üìä Vis√£o Executiva</h1>
                <div class="header-actions">
                    <button class="filter-btn" onclick="document.getElementById('configPanel').classList.remove('hidden')">
                        ‚öôÔ∏è Configurar
                    </button>
                </div>
            </header>

            <div class="kpi-grid" id="kpiGrid">
                <!-- KPIs ser√£o inseridos via JS -->
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Evolu√ß√£o CSAT por Bimestre</h3>
                    </div>
                    <div class="bar-chart" id="csatChart">
                        <!-- Gr√°fico ser√° inserido via JS -->
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Distribui√ß√£o por Segmento</h3>
                    </div>
                    <div class="donut-container" id="segmentoChart">
                        <!-- Gr√°fico ser√° inserido via JS -->
                    </div>
                </div>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Clientes que Precisam de Aten√ß√£o</h3>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Consultor</th>
                            <th>CSAT</th>
                            <th>Produtos</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="clientesRiscoTable">
                        <!-- Dados ser√£o inseridos via JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- P√ÅGINA 2: GEST√ÉO -->
        <div id="page-gestao" class="page-content">
            <header class="header">
                <h1 class="page-title">üë• Gest√£o de Consultores</h1>
            </header>

            <div class="kpi-grid" style="grid-template-columns: repeat(4, 1fr);" id="kpiGestao">
                <!-- KPIs ser√£o inseridos via JS -->
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">CSAT por Consultor</h3>
                    </div>
                    <div id="consultorChart" style="padding: 20px 0;">
                        <!-- Gr√°fico ser√° inserido via JS -->
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Resumo por Consultor</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Consultor</th>
                                <th>Clientes</th>
                                <th>CSAT</th>
                            </tr>
                        </thead>
                        <tbody id="consultorTable">
                            <!-- Dados ser√£o inseridos via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- P√ÅGINA 3: OPERACIONAL -->
        <div id="page-operacional" class="page-content">
            <header class="header">
                <h1 class="page-title">‚öôÔ∏è Operacional</h1>
            </header>

            <div class="kpi-grid" style="grid-template-columns: repeat(4, 1fr);" id="kpiOperacional">
                <!-- KPIs ser√£o inseridos via JS -->
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Horas por Consultor</h3>
                    </div>
                    <div class="bar-chart" id="horasChart">
                        <!-- Gr√°fico ser√° inserido via JS -->
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Rentabilidade</h3>
                    </div>
                    <div class="donut-container">
                        <div style="text-align: center; padding: 40px;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 10px;">Rentabilidade Total</div>
                            <div id="rentabilidadeValor" style="font-size: 42px; font-weight: 700; color: #00C853;">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- P√ÅGINA 4: GOVERNAN√áA -->
        <div id="page-governanca" class="page-content">
            <header class="header">
                <h1 class="page-title">üõ°Ô∏è Governan√ßa</h1>
            </header>

            <div class="kpi-grid" style="grid-template-columns: repeat(4, 1fr);" id="kpiGovernanca">
                <!-- KPIs ser√£o inseridos via JS -->
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Checklist de Conformidade</h3>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px;" id="checklistGrid">
                    <!-- Checklist ser√° inserido via JS -->
                </div>
            </div>
        </div>

        <!-- P√ÅGINA 5: CLIENTES -->
        <div id="page-clientes" class="page-content">
            <header class="header">
                <h1 class="page-title">üè¢ Todos os Clientes</h1>
            </header>

            <div class="chart-card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Segmento</th>
                            <th>Porte</th>
                            <th>Consultor</th>
                            <th>CSAT</th>
                            <th>Produtos</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="todosClientesTable">
                        <!-- Dados ser√£o inseridos via JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // Vari√°veis globais
        let SHEET_ID = localStorage.getItem('sheetId') || '';
        let dadosClientes = [];
        let dadosConsultores = [];
        let dadosCSAT = [];
        let dadosKPIs = {};

        // Verificar se j√° tem ID salvo
        window.onload = function() {
            if (SHEET_ID) {
                document.getElementById('configPanel').classList.add('hidden');
                loadData();
            } else {
                document.getElementById('loading').classList.add('hidden');
            }
        };

        // Conectar planilha
        function connectSheet() {
            const id = document.getElementById('sheetId').value.trim();
            if (!id) {
                alert('Por favor, cole o ID da planilha');
                return;
            }
            SHEET_ID = id;
            localStorage.setItem('sheetId', id);
            document.getElementById('configPanel').classList.add('hidden');
            loadData();
        }

        // Carregar dados do Google Sheets
        async function loadData() {
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                // Carregar cada aba
                dadosClientes = await fetchSheet('Clientes');
                dadosConsultores = await fetchSheet('Consultores');
                dadosCSAT = await fetchSheet('CSAT_Bimestre');
                const kpis = await fetchSheet('KPIs');
                dadosKPIs = kpis[0] || {};

                // Atualizar interface
                renderKPIs();
                renderCSATChart();
                renderSegmentoChart();
                renderClientesRisco();
                renderGestao();
                renderOperacional();
                renderGovernanca();
                renderTodosClientes();

                // Atualizar timestamp
                document.getElementById('lastUpdate').textContent = 
                    '√öltima atualiza√ß√£o: ' + new Date().toLocaleTimeString('pt-BR');

            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                alert('Erro ao carregar dados. Verifique se:\n\n1. O ID da planilha est√° correto\n2. A planilha est√° compartilhada como "Qualquer pessoa com o link"\n3. As abas t√™m os nomes corretos: Clientes, Consultores, CSAT_Bimestre, KPIs');
            }
            
            document.getElementById('loading').classList.add('hidden');
        }

        // Buscar dados de uma aba
        async function fetchSheet(sheetName) {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
            const response = await fetch(url);
            const text = await response.text();
            
            // Extrair JSON do response
            const json = JSON.parse(text.substring(47, text.length - 2));
            
            // Converter para array de objetos
            const headers = json.table.cols.map(col => col.label);
            const rows = json.table.rows.map(row => {
                const obj = {};
                row.c.forEach((cell, i) => {
                    obj[headers[i]] = cell ? (cell.v !== null ? cell.v : '') : '';
                });
                return obj;
            });
            
            return rows;
        }

        // Renderizar KPIs principais
        function renderKPIs() {
            const grid = document.getElementById('kpiGrid');
            const totalClientes = dadosKPIs.Total_Clientes_Ativos || dadosClientes.filter(c => c.Ativo === 'S').length;
            const csatMedio = dadosKPIs.CSAT_Medio || calcularMedia(dadosClientes, 'CSAT_Medio');
            const percRisco = dadosKPIs.Perc_Clientes_Risco || 0;
            const clientesEstrategicos = dadosKPIs.Clientes_Estrategicos || dadosClientes.filter(c => c.Cliente_Estrategico == 1).length;

            grid.innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">Clientes Ativos</div>
                    <div class="kpi-value">${totalClientes}</div>
                    <div class="kpi-trend up">Base atual</div>
                </div>
                <div class="kpi-card ${csatMedio >= 7 ? 'success' : csatMedio >= 5 ? 'warning' : 'danger'}">
                    <div class="kpi-label">CSAT M√©dio</div>
                    <div class="kpi-value">${Number(csatMedio).toFixed(2)}</div>
                    <div class="kpi-trend">Nota m√©dia da base</div>
                </div>
                <div class="kpi-card danger">
                    <div class="kpi-label">Clientes em Risco</div>
                    <div class="kpi-value">${percRisco}%</div>
                    <div class="kpi-trend down">CSAT ‚â§ 5</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">Clientes Estrat√©gicos</div>
                    <div class="kpi-value">${clientesEstrategicos}</div>
                    <div class="kpi-trend up">Multi-produto</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Consultores</div>
                    <div class="kpi-value">${dadosKPIs.Total_Consultores || dadosConsultores.length}</div>
                    <div class="kpi-trend">Time ativo</div>
                </div>
            `;
        }

        // Renderizar gr√°fico de CSAT
        function renderCSATChart() {
            const chart = document.getElementById('csatChart');
            if (!dadosCSAT.length) {
                chart.innerHTML = '<div style="text-align:center;padding:50px;color:#666;">Sem dados de CSAT</div>';
                return;
            }

            const maxCSAT = Math.max(...dadosCSAT.map(d => d.CSAT_Medio || 0));
            
            chart.innerHTML = dadosCSAT.map(d => `
                <div class="bar-container">
                    <div class="bar" style="height: ${((d.CSAT_Medio || 0) / 10) * 200}px;">
                        <span class="bar-value">${Number(d.CSAT_Medio || 0).toFixed(1)}</span>
                    </div>
                    <span class="bar-label">${d.Bimestre_Nome || 'Bim ' + d.Bimestre}</span>
                </div>
            `).join('');
        }

        // Renderizar gr√°fico de segmentos
        function renderSegmentoChart() {
            const container = document.getElementById('segmentoChart');
            const segmentos = {};
            
            dadosClientes.forEach(c => {
                const seg = c.Segmento || 'Outros';
                segmentos[seg] = (segmentos[seg] || 0) + 1;
            });

            const total = dadosClientes.length;
            const cores = ['#FF6600', '#00C853', '#1E88E5', '#9C27B0', '#FFB300'];
            let graus = 0;
            let gradiente = [];
            let legendaHTML = '';
            
            Object.entries(segmentos).forEach(([seg, count], i) => {
                const perc = (count / total) * 100;
                const grausFim = graus + (perc * 3.6);
                gradiente.push(`${cores[i % cores.length]} ${graus}deg ${grausFim}deg`);
                legendaHTML += `
                    <div class="legend-item">
                        <div class="legend-color" style="background: ${cores[i % cores.length]};"></div>
                        <span>${seg} (${count})</span>
                    </div>
                `;
                graus = grausFim;
            });

            container.innerHTML = `
                <div class="donut" style="background: conic-gradient(${gradiente.join(', ')});">
                    <div class="donut-hole">
                        <span class="donut-value">${total}</span>
                        <span class="donut-label">clientes</span>
                    </div>
                </div>
                <div class="legend">${legendaHTML}</div>
            `;
        }

        // Renderizar clientes em risco
        function renderClientesRisco() {
            const tbody = document.getElementById('clientesRiscoTable');
            const clientesRisco = dadosClientes
                .filter(c => c.CSAT_Medio && c.CSAT_Medio < 7)
                .sort((a, b) => (a.CSAT_Medio || 0) - (b.CSAT_Medio || 0))
                .slice(0, 5);

            if (!clientesRisco.length) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#666;">Nenhum cliente em risco üéâ</td></tr>';
                return;
            }

            tbody.innerHTML = clientesRisco.map(c => {
                const csat = Number(c.CSAT_Medio || 0);
                const status = csat <= 5 ? 'danger' : 'warning';
                const statusText = csat <= 5 ? 'Cr√≠tico' : 'Aten√ß√£o';
                
                return `
                    <tr>
                        <td><strong>${c.Nome_Cliente}</strong></td>
                        <td>${c.Nome_Consultor || '-'}</td>
                        <td>${csat.toFixed(1)}</td>
                        <td>${c.Qtd_Produtos || 0}</td>
                        <td><span class="status-badge ${status}">${statusText}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // Renderizar p√°gina de Gest√£o
        function renderGestao() {
            // KPIs
            const kpiGrid = document.getElementById('kpiGestao');
            const totalConsultores = dadosConsultores.length;
            const mediaClientes = calcularMedia(dadosConsultores, 'Qtd_Clientes');
            const mediaCSAT = calcularMedia(dadosConsultores, 'CSAT_Medio');

            kpiGrid.innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">Total Consultores</div>
                    <div class="kpi-value">${totalConsultores}</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">M√©dia Clientes/Consultor</div>
                    <div class="kpi-value">${mediaClientes.toFixed(1)}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">CSAT M√©dio Time</div>
                    <div class="kpi-value">${mediaCSAT.toFixed(2)}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Total Horas</div>
                    <div class="kpi-value">${formatNumber(dadosKPIs.Total_Horas_Faturadas || 0)}</div>
                </div>
            `;

            // Gr√°fico de barras de CSAT
            const chartDiv = document.getElementById('consultorChart');
            const consultoresOrdenados = [...dadosConsultores].sort((a, b) => (b.CSAT_Medio || 0) - (a.CSAT_Medio || 0));
            
            chartDiv.innerHTML = consultoresOrdenados.map(c => {
                const csat = Number(c.CSAT_Medio || 0);
                const cor = csat >= 7 ? 'success' : csat >= 5 ? '' : 'danger';
                
                return `
                    <div class="progress-row">
                        <span class="progress-label">${c.Nome_Consultor}</span>
                        <div class="progress-bar">
                            <div class="progress-fill ${cor}" style="width: ${csat * 10}%;"></div>
                        </div>
                        <span class="progress-value">${csat.toFixed(1)}</span>
                    </div>
                `;
            }).join('');

            // Tabela
            const tbody = document.getElementById('consultorTable');
            tbody.innerHTML = consultoresOrdenados.map(c => {
                const csat = Number(c.CSAT_Medio || 0);
                const status = csat >= 7 ? 'success' : csat >= 5 ? 'warning' : 'danger';
                
                return `
                    <tr>
                        <td>${c.Nome_Consultor}</td>
                        <td>${c.Qtd_Clientes || 0}</td>
                        <td><span class="status-badge ${status}">${csat.toFixed(1)}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // Renderizar p√°gina Operacional
        function renderOperacional() {
            const kpiGrid = document.getElementById('kpiOperacional');
            const horasFat = dadosKPIs.Total_Horas_Faturadas || 0;
            const horasNaoFat = dadosKPIs.Total_Horas_Nao_Faturadas || 0;
            const taxaNaoFat = horasFat > 0 ? ((horasNaoFat / (horasFat + horasNaoFat)) * 100).toFixed(1) : 0;
            const rentabilidade = dadosKPIs.Rentabilidade_Total || 0;

            kpiGrid.innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">Horas Faturadas</div>
                    <div class="kpi-value">${formatNumber(horasFat)}h</div>
                </div>
                <div class="kpi-card ${taxaNaoFat > 15 ? 'danger' : taxaNaoFat > 10 ? 'warning' : 'success'}">
                    <div class="kpi-label">Taxa N√£o Faturamento</div>
                    <div class="kpi-value">${taxaNaoFat}%</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Receita Total</div>
                    <div class="kpi-value">${formatCurrency(dadosKPIs.Receita_Total || 0)}</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">Rentabilidade</div>
                    <div class="kpi-value">${formatCurrency(rentabilidade)}</div>
                </div>
            `;

            // Gr√°fico de horas
            const horasChart = document.getElementById('horasChart');
            const consultoresHoras = [...dadosConsultores].sort((a, b) => (b.Horas_Faturadas || 0) - (a.Horas_Faturadas || 0));
            const maxHoras = Math.max(...consultoresHoras.map(c => c.Horas_Faturadas || 0));

            horasChart.innerHTML = consultoresHoras.slice(0, 6).map(c => `
                <div class="bar-container">
                    <div class="bar" style="height: ${((c.Horas_Faturadas || 0) / maxHoras) * 200}px;">
                        <span class="bar-value">${c.Horas_Faturadas || 0}h</span>
                    </div>
                    <span class="bar-label">${c.Nome_Consultor?.split(' ')[0] || '-'}</span>
                </div>
            `).join('');

            // Rentabilidade
            document.getElementById('rentabilidadeValor').textContent = formatCurrency(rentabilidade);
        }

        // Renderizar p√°gina Governan√ßa
        function renderGovernanca() {
            const kpiGrid = document.getElementById('kpiGovernanca');
            const total = dadosClientes.length;
            const comCSAT = dadosClientes.filter(c => c.CSAT_Medio).length;
            const comConsultor = dadosClientes.filter(c => c.Nome_Consultor).length;
            const comBimestre = dadosClientes.filter(c => c.Teve_Bimestre == 1).length;
            const aderencia = ((comCSAT + comConsultor + comBimestre) / (total * 3) * 100).toFixed(0);

            kpiGrid.innerHTML = `
                <div class="kpi-card ${aderencia >= 90 ? 'success' : aderencia >= 70 ? 'warning' : 'danger'}">
                    <div class="kpi-label">Ader√™ncia ao Modelo</div>
                    <div class="kpi-value">${aderencia}%</div>
                </div>
                <div class="kpi-card ${total - comCSAT > 0 ? 'warning' : 'success'}">
                    <div class="kpi-label">Sem CSAT</div>
                    <div class="kpi-value">${total - comCSAT}</div>
                </div>
                <div class="kpi-card ${total - comConsultor > 0 ? 'danger' : 'success'}">
                    <div class="kpi-label">Sem Consultor</div>
                    <div class="kpi-value">${total - comConsultor}</div>
                </div>
                <div class="kpi-card ${total - comBimestre > 0 ? 'warning' : 'success'}">
                    <div class="kpi-label">Sem Bimestre</div>
                    <div class="kpi-value">${total - comBimestre}</div>
                </div>
            `;

            // Checklist
            const checklistGrid = document.getElementById('checklistGrid');
            checklistGrid.innerHTML = `
                <div>
                    <div class="checklist-item ${comConsultor === total ? 'success' : 'warning'}">
                        <span>${comConsultor === total ? '‚úÖ' : '‚ö†Ô∏è'} Clientes com Consultor</span>
                        <span>${comConsultor}/${total}</span>
                    </div>
                    <div class="checklist-item ${comCSAT === total ? 'success' : 'warning'}">
                        <span>${comCSAT === total ? '‚úÖ' : '‚ö†Ô∏è'} Clientes com CSAT</span>
                        <span>${comCSAT}/${total}</span>
                    </div>
                </div>
                <div>
                    <div class="checklist-item ${comBimestre === total ? 'success' : 'warning'}">
                        <span>${comBimestre === total ? '‚úÖ' : '‚ö†Ô∏è'} Bimestre Agendado</span>
                        <span>${comBimestre}/${total}</span>
                    </div>
                    <div class="checklist-item success">
                        <span>‚úÖ Produtos Atribu√≠dos</span>
                        <span>${total}/${total}</span>
                    </div>
                </div>
            `;
        }

        // Renderizar todos os clientes
        function renderTodosClientes() {
            const tbody = document.getElementById('todosClientesTable');
            
            tbody.innerHTML = dadosClientes.map(c => {
                const csat = Number(c.CSAT_Medio || 0);
                const status = csat >= 7 ? 'success' : csat >= 5 ? 'warning' : 'danger';
                const statusText = csat >= 7 ? 'Saud√°vel' : csat >= 5 ? 'Aten√ß√£o' : 'Cr√≠tico';
                
                return `
                    <tr>
                        <td><strong>${c.Nome_Cliente}</strong></td>
                        <td>${c.Segmento || '-'}</td>
                        <td>${c.Porte || '-'}</td>
                        <td>${c.Nome_Consultor || '-'}</td>
                        <td>${csat ? csat.toFixed(1) : '-'}</td>
                        <td>${c.Qtd_Produtos || 0}</td>
                        <td><span class="status-badge ${status}">${statusText}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // Fun√ß√µes auxiliares
        function calcularMedia(arr, campo) {
            const valores = arr.map(item => Number(item[campo] || 0)).filter(v => v > 0);
            return valores.length ? valores.reduce((a, b) => a + b, 0) / valores.length : 0;
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('pt-BR').format(num);
        }

        function formatCurrency(num) {
            if (num >= 1000000) {
                return 'R$ ' + (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return 'R$ ' + (num / 1000).toFixed(0) + 'K';
            }
            return 'R$ ' + formatNumber(num);
        }

        // Navega√ß√£o
        function showPage(pageId, element) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById('page-' + pageId).classList.add('active');
            if (element) element.classList.add('active');
        }
    </script>
</body>
</html>
